#!/bin/sh

echo "ğŸ” Running pre-merge validations..."

# Check if we're merging into main branch
current_branch=$(git rev-parse --abbrev-ref HEAD)

if [ "$current_branch" = "main" ]; then
    echo "ğŸ›¡ï¸  Running full validation on merge to main..."
    
    # Run lint-staged for code quality
    if ! npx lint-staged; then
        echo "âŒ Lint-staged validation failed. Merge aborted."
        exit 1
    fi
    
    # Run additional validations
    if ! pnpm run typecheck; then
        echo "âŒ TypeScript validation failed. Merge aborted."
        exit 1
    fi
    
    if ! pnpm run build; then
        echo "âŒ Build validation failed. Merge aborted."
        exit 1
    fi
    
    echo "âœ… All merge validations passed!"
else
    echo "âš ï¸  Skipping validations (not merging to main branch)"
fi
